# Telegram Rating Bot

Это Telegram-бот для регистрации пользователей, учета балансов операторов и формирования рейтингов (операторов, администраторов и топ-администраторов). Бот позволяет:
- Регистрировать пользователя и получать его ник, сайт, смену и администратора.
- Принимать записи балансов в виде сообщений.
- Удалять последние записи баланса.
- Отправлять рейтинговые сообщения (ежедневные и еженедельные) с подсчетом балансов.
- Проводить периодическую очистку базы от устаревших записей с помощью планировщика (APScheduler).
- Логировать работу в файлы `bot.log` (общая информация) и `detailed.log` (детальная информация и ошибки).

## Технологии

- **Python 3.8+**
- [aiogram](https://docs.aiogram.dev/) — библиотека для создания Telegram-ботов.
- [SQLAlchemy](https://www.sqlalchemy.org/) — ORM для работы с базой данных.
- [APScheduler](https://apscheduler.readthedocs.io/) — планировщик задач.
- [python-dotenv](https://github.com/theskumar/python-dotenv) — для загрузки переменных окружения из файла `.env`.

## Функциональные возможности

- **Регистрация и удаление пользователя:**  
  При команде `/start` бот запрашивает никнейм и проводит пользователя через последовательность шагов для регистрации (выбор сайта, смены и администратора).

- **Учёт балансов:**  
  Пользователь отправляет свой баланс в формате, например, `112,50` или `20,50 + КС 100,43`. Бот записывает баланс в базу данных, после чего происходит уведомление группы.

- **Удаление баланса:**  
  Команда `/rbalance` позволяет удалить последнюю запись баланса (для зарегистрированных пользователей).

- **Рейтинги:**  
  Бот формирует рейтинги операторов, администраторов и топ-администраторов, а также еженедельные рейтинги, основываясь на суммарном балансе, и отправляет их в указанный чат.

- **Планировщик:**  
  Используется APScheduler для периодического удаления старых записей балансов (например, записи старше 9 дней).

- **Логирование:**  
  Информация о работе бота записывается в файлы `bot.log` и `detailed.log`.

## Структура проекта

├── main.py # Основной файл запуска бота
├── database.py # Работа с базой данных (модели, подключение, функции) 
├── keyboards.py # Определение клавиатур для взаимодействия с ботом 
├── sendrating.py # Модуль для отправки различных рейтингов 
├── send_logs.py # Логирование перезапусков и ошибок бота 
├── notify_group.py # Уведомления в группу (например, о новых записях баланса) 
├── .env # Файл с переменными окружения (не должен попадать в репозиторий) 
├── .gitignore # Файл для исключения из отслеживания (например, .env, pycache) 
├── requirements.txt # Зависимости проекта └── README.md # Этот файл
